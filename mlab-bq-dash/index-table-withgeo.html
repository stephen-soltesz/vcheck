<html>
<head>
  <title>hellodashboard</title>
  <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
  <script type='text/javascript'>
      google.charts.load('current', {'packages': ['geochart', 'table', 'corechart']});
      google.charts.setOnLoadCallback(drawTableAndMap);

      geodata = {% autoescape off %}{{ data }}{% endautoescape %}

      function drawTableAndMap() {
          drawMarkersMap();
          drawTable();
          drawChart();
      }

      function drawChart() {
        if (! geodata) return;
        var data = new google.visualization.DataTable(geodata);

        var options = {
          title: 'Things',
          curveType: 'none',
          legend: { position: 'bottom' }
        };

        var chart = new google.visualization.LineChart(
            document.getElementById('curve_chart'));
        chart.draw(data, options);
      }

      function drawTable() {
        if (! geodata) return;
        var data = new google.visualization.DataTable(geodata);

        var options = {
          showRowNumber: true,
          width: '100%',
          height: '100%'
        };

        var table = new google.visualization.Table(
            document.getElementById('table_div'));
        table.draw(data, options);
      }

      function drawMarkersMap() {
        if (! geodata) return;
        var data = new google.visualization.DataTable(geodata);

        var options = {
          region: 'US',
          legend: {textStyle: {color: 'black', fontSize: 10}},
          displayMode: 'region',
          resolution: "provinces"
        };

        var chart = new google.visualization.GeoChart(
          document.getElementById('chart_div'));
        chart.draw(data, options);
     };
  </script>
</head>
<body>
  <h2>Hello Dashboard!</h2>
  <div id='chart_div'></div>
       <p>A simple example of a graphical dashboard, backed by
          Google's BigQuery and running in Python on App Engine.</p>
       <p>Click on the map to highlight the value of each state, as
          generated by this query:</p>
  <div id='curve_chart'></div>
  <div id='table_div'></div>
       <pre> {{ query }} </pre>
</body>
</html>
